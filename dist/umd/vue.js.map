{"version":3,"file":"vue.js","sources":["../../src/util/index.js","../../src/observer/array.js","../../src/observer/index.js","../../src/state.js","../../src/compiler/index.js","../../src/init.js","../../src/index.js"],"sourcesContent":["export function isObject (data) {\n    return typeof data === 'object' && data !== null;\n}\n\nexport function def (data, key, value) {\n    Object.defineProperty(data, key, {\n        enumerable: false,\n        configurable: false,\n        value,\n    })\n}","// 重写数据方法\n// push shift unshift pop reverse sort splice 会导致原数组发生变化的方法\nlet oldArrayMethods = Array.prototype;\n// 原型链查找\n// value.__proto__ = arrayMethods;\n// arrayMethods.__proto__ = oldArrayMethods;\nexport const arrayMethods = Object.create(oldArrayMethods);\n\nconst methods = [\n    'push',\n    'shift',\n    'unshift',\n    'pop',\n    'reverse',\n    'sort',\n    'splice',\n];\n\nmethods.forEach(method => {\n    arrayMethods[method] = function (...args) {\n        // AOP切片编程\n        console.log(`用户调用了数组${method}方法`);\n        console.log('this===', this);\n        // 调用原生数组方法\n        const result = oldArrayMethods[method].apply(this, args);\n        let inserted;\n        const ob = this.__ob__;\n        switch (method) {\n            case 'push':\n                break;\n            case 'unshift':\n                inserted = args;\n                break;\n            case 'splice':\n                inserted = args.slice(2);\n                break;\n            default:\n                break;\n        }\n        if (inserted) ob.observerArray(inserted);\n        return result;\n    }\n})","// 核心方法：响应式原理\n// Object.defineProperty()不能兼容ie8及以下（vue2不支持ie8版本的主要原因）\nimport { isObject, def } from '../util/index';\nimport { arrayMethods } from './array';\n\nclass Observer {\n    constructor (value) {\n        // 给每一个监控过的对象增加一个__ob__属性\n        def(value, '__ob__', this);\n        if (Array.isArray(value)) {\n            // 不会对数组的索引进行观测，会导致性能问题。\n            value.__proto__ = arrayMethods;\n            // 递归，如果数据里包含对象继续监控\n            this.observerArray(value);\n        } else {\n            this.walk(value);\n        }\n    }\n    observerArray (value) {\n        for (let i = 0; i < value.length; i++) {\n            observe(value[i]);\n        }\n    }\n    walk (data) {\n        let keys = Object.keys(data);\n        keys.forEach(key => {\n            // 定义响应式数据\n            defineReactive(data, key, data[key]);\n        });\n    }\n}\nfunction defineReactive (data, key, value) {\n    // 递归\n    observe(value);\n    // 数据劫持\n    Object.defineProperty(data, key, {\n        configurable: true,\n        enumerable: false,\n        get () {\n            return value;\n        },\n        set (newValue) {\n            if (newValue === value) return;\n            console.log('数据更新了');\n            console.log(key);\n            console.log(newValue);\n            // 数据修改的话，递归重新执行Object.defineProperty\n            observe(newValue);\n            value = newValue;\n        }\n    })\n}\n\nexport function observe (data) {\n    const isObj = isObject(data);\n    if (!isObj) {\n        return;\n    }\n    console.log('observe==', data);\n    return new Observer(data);\n}","import { observe } from './observer/index';\n\nexport function initState (vm) {\n    const opts = vm.$options;\n    // vue数据来源顺序：属性，方法，数据data，计算属性，watch\n    if (opts.props) {\n        initProps(vm);\n    }\n    if (opts.methods) {\n        initMethod(vm);\n    }\n    if (opts.data) {\n        initData(vm);\n    }\n    if (opts.computed) {\n        initComputed(vm);\n    }\n    if (opts.watch) {\n        initWatch(vm);\n    }\n}\n\nfunction initProps (vm) {\n\n}\nfunction initMethod (vm) {\n    \n}\nfunction initData (vm) {\n    let data = vm.$options.data;\n    data = vm._data = typeof data === 'function' ? data.call(vm) : data;\n    // 对象劫持 数据修改，等到通知\n    // MVVM\n    // Object.defineProperty()给属性添加get和set方法\n    // 响应式原理\n    observe(data);\n}\nfunction initComputed (vm) {\n    \n}\nfunction initWatch (vm) {\n    \n}","/** \n * ast语法书\n*/\n// arguments[0] = 匹配到的标签 argument[1] = 匹配到的标签名字\nconst ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`;   // aaa-12df\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`; // ?: 匹配不捕获  <aaa:dfdf>\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 标签开头的正则 捕获的内容是标签名\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 匹配标签结尾的 </div>\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; // 匹配属性的\nconst startTagClose = /^\\s*(\\/?)>/; // 匹配标签结束的 >\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g; // 匹配{{}}\n\nexport function compilerToFunction (template) {\n    console.log(template, '=====');\n}","import { initState } from './state';\nimport { compilerToFunction } from './compiler/index';\n\nexport function initMixin (Vue) {\n    // 初始化流程\n    Vue.prototype._init = function (options) {\n        // 数据劫持\n        // vue中使用this.$options指代的就是用户传递的属性\n        const vm = this; \n        vm.$options = options;\n        // 初始化状态\n        initState(vm);\n\n        // 如果传入el属性，需要将页面渲染出来\n        if (vm.$options.el) {\n            vm.$mount(vm.$options.el);\n        }\n    }\n    Vue.prototype.$mount = function (el) {\n        const vm = this;\n        const options = vm.$options;\n        el = document.querySelector(el);\n        // 挂载优先级：默认先查找有没有render方法，没有render会采用template，没有template会用el中的内容。\n        if (!options.render) {\n            let template = options.template;\n            if (!template && el) {\n                template = el.outerHTML;\n            }\n            compilerToFunction(template);\n        }\n    }\n}\n","import { initMixin } from './init';\n\n\nfunction Vue (options) {\n    this._init(options);\n}\n// 通过引入文件的方式，给Vue原型上添加方法\ninitMixin(Vue);\nexport default Vue;"],"names":["isObject","data","def","key","value","Object","defineProperty","enumerable","configurable","oldArrayMethods","Array","prototype","arrayMethods","create","methods","forEach","method","args","console","log","result","apply","inserted","ob","__ob__","slice","observerArray","Observer","constructor","isArray","__proto__","walk","i","length","observe","keys","defineReactive","get","set","newValue","isObj","initState","vm","opts","$options","props","initData","computed","watch","_data","call","compilerToFunction","template","initMixin","Vue","_init","options","el","$mount","document","querySelector","render","outerHTML"],"mappings":"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"}